# Template file for 'ntpd-rs'
pkgname=ntpd-rs
version=1.7.0
revision=1
build_style=cargo
make_check_args="--
 --skip daemon::keyexchange::tests::client_connection_refused
 --skip daemon::keyexchange::tests::key_exchange_connection_limiter
 --skip daemon::keyexchange::tests::key_exchange_weird_packet
"
make_install_args="--path ntpd"
short_desc="Full-featured implementation of the Network Time Protocol"
maintainer="Orphaned <orphan@voidlinux.org>"
license="Apache-2.0 OR MIT"
homepage="https://github.com/pendulum-project/ntpd-rs"
changelog="https://raw.githubusercontent.com/pendulum-project/ntpd-rs/main/CHANGELOG.md"
distfiles="https://github.com/pendulum-project/ntpd-rs/archive/refs/tags/v${version}.tar.gz"
checksum=f1585c2c0f052423cb5187ceed4f6a6d2b43a177b4de1d1f8bcc443d5386ca55

system_accounts="_ntpd_rs"
conf_files="/etc/ntpd-rs/ntp.toml"
provides="ntp-daemon-0_1"
alternatives="
 ntpd:ntpd:/usr/bin/ntp-daemon
 ntpd:ntpd:/etc/sv/ntpd-rs"

post_patch() {
	# apply patched Cargo.toml changes to lockfile
	cargo metadata > /dev/null
}

post_install() {
	vinstall ntp.toml 644 etc/ntpd-rs
	vlicense LICENSE-MIT
	vsv ntpd-rs
	vsv ntpd-rs-metrics

	for manpage in docs/precompiled/man/*; do
		vman ${manpage}
	done
}
