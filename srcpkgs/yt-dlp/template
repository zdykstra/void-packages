# Template file for 'yt-dlp'
pkgname=yt-dlp
version=2026.01.29
revision=1
# XXX: keep python3-yt-dlp-ejs in sync with pyproject.toml
_ejs_ver=0.4.0
build_style=python3-pep517
make_check_args="-k not((download)or(test_socks))"
hostmakedepends="hatchling"
depends="python3-Brotli python3-certifi python3-mutagen python3-pycryptodomex
 python3-urllib3 python3-requests python3-websockets"
checkdepends="python3-pytest-xdist python3-Brotli python3-certifi python3-mutagen
 python3-pycryptodomex python3-urllib3 python3-requests python3-websockets"
short_desc="CLI program to download videos from YouTube and other sites"
maintainer="classabbyamp <void@placeviolette.net>"
license="Unlicense"
homepage="https://github.com/yt-dlp/yt-dlp"
changelog="https://raw.githubusercontent.com/yt-dlp/yt-dlp/master/Changelog.md"
distfiles="https://github.com/yt-dlp/yt-dlp/releases/download/${version}/yt-dlp.tar.gz>yt-dlp-$version.tar.gz"
checksum=e4edd01abd229f646b8280209d462785c2d0929f7612fb24740fa528e5eff433

if [ "$XBPS_WORDSIZE" -eq "$XBPS_TARGET_WORDSIZE" ]; then
	# nodejs can only be built for this platform combination
	depends+=" python3-yt-dlp-ejs>=${_ejs_ver}_1<=${_ejs_ver}_9999"
	checkdepends+=" python3-yt-dlp-ejs"
fi

post_install() {
	cat <<- "EOF" > youtube-dl
	#!/bin/sh
	exec yt-dlp --compat-options youtube-dl "$@"
	EOF
	vbin youtube-dl
}

youtube-dl_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" (transitional compatibility package)"
	pkg_install() {
		vmove usr/bin/youtube-dl
	}
}

python3-youtube-dl_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" (transitional dummy package)"
	metapackage=yes
}
